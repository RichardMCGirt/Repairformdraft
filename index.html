<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Submit a Repair</title>
<style>
  :root{
    --bg:#f7f9fc; --card:#ffffff; --ink:#1e2430; --muted:#6b7280; --line:#e5e7eb;
    --brand:#0b3a64; --accent:#0f9ba8; --warn:#c0372f;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,var(--bg),#eef2f7);color:var(--ink);
       font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:980px;margin:40px auto;padding:0 16px 40px}
  .header{display:flex;align-items:center;gap:16px;margin-bottom:16px}
  .badge{padding:.25rem .5rem;border:1px solid var(--accent);color:var(--accent);
         border-radius:999px;font-size:.75rem;font-weight:600;letter-spacing:.02em}
  h1{margin:.2rem 0 0;font-size:clamp(1.35rem,2.5vw,1.8rem);color:var(--brand)}
  form{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:20px;
       box-shadow:0 10px 28px rgba(15,23,42,.06)}
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
  .col-6{grid-column:span 6}.col-12{grid-column:span 12}
  @media (max-width:800px){.col-6{grid-column:span 12}}
  label{display:block;font-weight:600;margin:2px 0 8px;color:#0f172a}
  .hint{font-size:.82rem;color:var(--muted);margin-top:4px}
  input[type="text"],input[type="number"],input[type="date"],input[type="search"],
  input[type="tel"],input[type="email"],input[type="url"],input[type="time"],
  textarea,select{width:100%;padding:12px;border:1px solid var(--line);border-radius:10px;
    background:#fff;color:var(--ink);outline:none;transition:border-color .15s,box-shadow .15s}
  input:focus,select:focus,textarea:focus{border-color:var(--accent);
    box-shadow:0 0 0 4px color-mix(in oklab,var(--accent) 20%,transparent)}
  .row{border-top:1px dashed var(--line);padding-top:16px;margin-top:8px}
  .checkline{display:flex;align-items:center;gap:10px;margin-top:8px;font-weight:600}
  .radio-row,.inline{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
  .pill{padding:.45rem .75rem;border:1px solid var(--line);border-radius:999px;display:inline-flex;
        gap:.5rem;align-items:center;cursor:pointer;user-select:none}
  .pill input{accent-color:var(--accent)}
  .money::before{content:"$";position:absolute;left:12px;top:50%;translate:0 -50%;
    color:var(--muted);pointer-events:none}
  .money input{padding-left:26px}
  .section-title{font-size:.9rem;font-weight:700;text-transform:uppercase;letter-spacing:.06em;
    color:var(--muted);margin:6px 0 2px}
  .actions{display:flex;gap:12px;justify-content:flex-end;margin-top:18px;border-top:1px solid var(--line);padding-top:16px}
  button{appearance:none;border:1px solid var(--brand);background:var(--brand);color:#fff;
    padding:12px 16px;border-radius:10px;font-weight:700;cursor:pointer}
  button.secondary{border-color:var(--line);background:#fff;color:var(--brand)}
  .hide{display:none !important}
  .req::after{content:" *";color:var(--warn)}
  .co-card{border:1px solid var(--line);border-radius:12px;padding:12px}
  .co-list{display:grid;gap:10px}
  .job-mirror{font-weight:700;color:var(--brand)}
  /* Print */
  @media print{body{background:#fff}.wrap{margin:0;padding:0}.actions{display:none}form{box-shadow:none;border:none;padding:0}}
</style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <span class="badge">Repair</span>
      <div>
        <h1>Submit a Repair</h1>
      </div>
    </div>

    <form id="repairForm" onsubmit="event.preventDefault(); window.print();">
      <!-- Status -->
      <div class="grid row">
        <div class="col-12">
          <div class="checkline">
            <input id="workCompleted" type="checkbox" />
            <label for="workCompleted" style="margin:0;">Work is completed</label>
          </div>
        </div>
      </div>

      <!-- Basics -->
      <div class="grid row">
           <div class="col-6">
          <label class="req" for="jobName">Job name</label>
          <input id="jobName" type="text" placeholder="Job or lot name" required />
        </div>
        <div class="col-6">
          <label class="req" for="branch">Branch</label>
          <select id="branch" required>
            <option value="" selected disabled>Choose a branch…</option>
            <option>Raleigh</option><option>Charleston</option><option>Greensboro</option>
            <option>Myrtle Beach</option><option>Wilmington</option>
            <option>Charlotte</option><option>Columbia</option><option>Greenville, SC</option>
          </select>
        </div>
      

        <div class="col-6">
          <label class="req" for="customerName">Customer name</label>
          <input id="customerName" type="text" placeholder="e.g., John & Jane Doe" required />
        </div>
      </div>

      <!-- Payment flags -->
      <div class="grid row">
        <div class="col-6">
          <div class="section-title">Pre-payment</div>
          <div class="radio-row" role="radiogroup">
            <label class="pill"><input type="radio" name="prepay" value="yes" /> Yes</label>
            <label class="pill"><input type="radio" name="prepay" value="no" checked /> No</label>
          </div>

          <!-- Pre-payment amount -->
          <div id="prepayAmountWrap" class="grid hide" style="margin-top:10px;">
            <div class="col-12 money" style="position:relative;">
              <label for="prepayAmount">Pre-payment amount</label>
              <input id="prepayAmount" type="text" inputmode="decimal" placeholder="0.00" />
            </div>
          </div>

          <!-- Mock Change Orders (shown when Pre-payment = Yes) -->
          <div id="mockCOWrap" class="grid hide" style="margin-top:12px;">
            <div class="col-12">
              <div class="section-title">Mock Change Orders</div>
              <div class="hint">Suggested items for <span id="jobMirror" class="job-mirror">[Job name]</span></div>
              <div id="coList" class="co-list" style="margin-top:8px;"></div>
            </div>
          </div>
        </div>

        <div class="col-6">
          <div class="section-title">Change orders</div>
          <div class="radio-row">
            <label class="pill"><input type="radio" name="co" value="yes" /> Yes</label>
            <label class="pill"><input type="radio" name="co" value="no" checked /> No</label>
          </div>
          <div id="coDetailsWrap" class="grid hide" style="margin-top:10px;">
            <div class="col-12">
              <label for="coDetails">Change order details</label>
              <textarea id="coDetails" rows="3" placeholder="Describe change orders…"></textarea>
            </div>
          </div>
        </div>
      </div>

      <!-- Project -->
      <div class="grid row">
        <div class="col-6">
          <label class="req">Project type</label>
          <div class="inline">
            <label class="pill"><input type="radio" name="ptype" value="Commercial" required /> Commercial</label>
            <label class="pill"><input type="radio" name="ptype" value="Residential" /> Residential</label>
          </div>
          <div class="hint">Commercial will show subcontractor & sub payment fields.</div>
        </div>

        <!-- Commercial-only fields -->
        <div id="commercialFields" class="col-12 grid hide" style="margin-top:6px;">
          <div class="col-6 money" style="position:relative;">
            <label class="req" for="subPayAmt">Sub payment amount</label>
            <input id="subPayAmt" type="text" inputmode="decimal" placeholder="0.00" />
            <div class="hint">Amount to pay subcontractor.</div>
          </div>
          <div class="col-6">
            <label class="req" for="subcontractor">Subcontractor</label>
            <input id="subcontractor" type="text" placeholder="Company or contact" />
          </div>
        </div>

        <div class="col-6">
          <label class="req" for="fieldTech">Field Technician</label>
          <input id="fieldTech" type="text" placeholder="Tech name" required />
        </div>

       
        <div class="col-6">
          <label for="poNum">PO #</label>
          <input id="poNum" type="text" placeholder="Optional" />
        </div>

        <div class="col-12">
          <label for="notes">DOW</label>
          <textarea id="notes" rows="4" placeholder="Any additional info…"></textarea>
        </div>
      </div>

      <!-- Actions -->
      <div class="actions">
        <button type="button" class="secondary" onclick="document.getElementById('repairForm').reset(); toggleReveals(); refreshMockCO();">Clear</button>
        <button type="submit">Print / Save</button>
      </div>
    </form>
  </div>

<script>
/* ===== Utilities ===== */
function formatMoneyInput(el){
  const raw = (el.value || "").replace(/[^0-9.]/g, "");
  if(!raw){ el.value=""; return; }
  const firstDot = raw.indexOf(".");
  const sanitized = firstDot === -1 ? raw : raw.slice(0, firstDot+1) + raw.slice(firstDot+1).replace(/\./g,"");
  const num = Number.parseFloat(sanitized);
  if(Number.isFinite(num)) el.value = num.toFixed(2);
}

function reveal(node, show){
  node.classList.toggle("hide", !show);
}

/* ===== Reveals (Prepay/CO + Commercial) ===== */
function toggleReveals(){
  const prepayYes = document.querySelector('input[name="prepay"][value="yes"]');
  const coYes = document.querySelector('input[name="co"][value="yes"]');
  const projCommercial = document.querySelector('input[name="ptype"][value="Commercial"]');

  reveal(document.getElementById("prepayAmountWrap"), prepayYes && prepayYes.checked);
  reveal(document.getElementById("mockCOWrap"), prepayYes && prepayYes.checked);
  reveal(document.getElementById("coDetailsWrap"), coYes && coYes.checked);
  reveal(document.getElementById("commercialFields"), projCommercial && projCommercial.checked);

  // Require fields only when visible
  document.getElementById("subPayAmt").required = !!(projCommercial && projCommercial.checked);
  document.getElementById("subcontractor").required = !!(projCommercial && projCommercial.checked);
}

/* ===== Mock Change Orders =====
   - Generated whenever: Job name changes OR Pre-payment toggles to Yes.
   - Uses Job name as the theme so items "match" the job. */
function buildMockCO(job){
  const j = (job || "").trim();
  const base = j ? j : "Project";
  const items = [
    { code:"CO-001", title:`${base}: Material Upgrade`, amt: 250.00, note:"Customer requested higher-grade materials." },
    { code:"CO-002", title:`${base}: Scope Add – Extras`, amt: 175.00, note:"Additional minor repairs discovered on site." },
    { code:"CO-003", title:`${base}: Schedule Acceleration`, amt: 125.00, note:"Overtime / weekend work to meet deadline." },
    { code:"CO-004", title:`${base}: Owner Directive`, amt: 90.00, note:"Owner-directed modification to layout." }
  ];
  return items;
}

function renderCOList(items){
  const list = document.getElementById("coList");
  list.innerHTML = "";
  items.forEach(it=>{
    const card = document.createElement("div");
    card.className = "co-card";
    card.innerHTML = `
      <div style="display:flex;justify-content:space-between;gap:10px;align-items:center;margin-bottom:6px">
        <strong>${it.code}</strong>
        <span style="font-weight:700">$${it.amt.toFixed(2)}</span>
      </div>
      <div style="font-weight:600;margin-bottom:4px">${it.title}</div>
      <div class="hint">${it.note}</div>
    `;
    list.appendChild(card);
  });
}

function refreshMockCO(){
  const prepayYes = document.querySelector('input[name="prepay"][value="yes"]');
  const show = prepayYes && prepayYes.checked;
  reveal(document.getElementById("mockCOWrap"), show);
  if(!show) return;

  const job = document.getElementById("jobName").value || "";
  document.getElementById("jobMirror").textContent = job || "[Job name]";
  const items = buildMockCO(job);
  renderCOList(items);
}

/* ===== Wire-up ===== */
document.addEventListener("DOMContentLoaded", () => {
  // radio reveals
  document.querySelectorAll('input[name="prepay"], input[name="co"], input[name="ptype"]').forEach(r => {
    r.addEventListener("change", () => { toggleReveals(); refreshMockCO(); });
  });

  // update mock COs when Job name changes
  document.getElementById("jobName").addEventListener("input", refreshMockCO);

  // format $ fields on blur + basic input guards
  ["subPayAmt","prepayAmount"].forEach(id => {
    const el = document.getElementById(id);
    el.addEventListener("blur", () => formatMoneyInput(el));
    el.addEventListener("input", () => {
      const cur = el.value;
      const ok = /^[0-9]*\.?[0-9]{0,2}$/.test(cur.replace(/[^0-9.]/g,""));
      if(!ok) el.value = cur.replace(/[^0-9.]/g,"");
    });
  });

  // initial state
  toggleReveals();
  refreshMockCO();

  // validation on submit
  document.getElementById("repairForm").addEventListener("submit", (e) => {
    const form = e.currentTarget;
    if(!form.checkValidity()){
      e.preventDefault();
      form.reportValidity();
    }
  });
});
</script>
</body>
</html>
